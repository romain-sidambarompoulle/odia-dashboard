<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard CEO - ODIA HOLDING</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen" x-data="dashboard()" x-init="init()">

    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-white">ODIA HOLDING</h1>
                <p class="text-gray-400 text-sm">Dashboard CEO</p>
            </div>
            <div class="text-right">
                <p class="text-gray-400 text-sm">Derniere MAJ</p>
                <p class="text-white font-mono" x-text="data.meta?.lastUpdate || '-'"></p>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-8">

        <!-- Alertes -->
        <template x-if="data.alertes?.length > 0">
            <section class="mb-8">
                <template x-for="alerte in data.alertes" :key="alerte.message">
                    <div class="alert-card mb-3 p-4 rounded-lg flex items-start gap-4"
                         :class="alerte.niveau === 'URGENT' ? 'bg-red-900/50 border border-red-500' : 'bg-yellow-900/50 border border-yellow-500'">
                        <div class="flex-shrink-0">
                            <span class="text-2xl" x-text="alerte.niveau === 'URGENT' ? 'üö®' : '‚ö†Ô∏è'"></span>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="font-bold" :class="alerte.niveau === 'URGENT' ? 'text-red-400' : 'text-yellow-400'" x-text="alerte.niveau"></span>
                                <span class="text-gray-400">-</span>
                                <span x-text="alerte.message"></span>
                            </div>
                            <p class="text-sm text-gray-300">
                                <span class="font-medium" x-text="alerte.filiale.toUpperCase()"></span> :
                                <span x-text="alerte.mission"></span>
                            </p>
                            <p class="text-sm text-gray-400 mt-1" x-text="'‚Üí ' + alerte.action"></p>
                        </div>
                    </div>
                </template>
            </section>
        </template>

        <!-- Synthese -->
        <section class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                <p class="text-gray-400 text-sm">Total Missions</p>
                <p class="text-3xl font-bold text-white" x-text="data.synthese?.totalMissions || 0"></p>
            </div>
            <div class="bg-gray-800 rounded-lg p-4 border border-green-500/50">
                <p class="text-gray-400 text-sm">Actives</p>
                <p class="text-3xl font-bold text-green-400" x-text="data.synthese?.missionsActives || 0"></p>
            </div>
            <div class="bg-gray-800 rounded-lg p-4 border border-red-500/50">
                <p class="text-gray-400 text-sm">Bloquees</p>
                <p class="text-3xl font-bold text-red-400" x-text="data.synthese?.missionsBloquees || 0"></p>
            </div>
            <div class="bg-gray-800 rounded-lg p-4 border border-gray-600">
                <p class="text-gray-400 text-sm">Backlog</p>
                <p class="text-3xl font-bold text-gray-300" x-text="data.synthese?.missionsBacklog || 0"></p>
            </div>
        </section>

        <!-- Filiales -->
        <section class="mb-8">
            <h2 class="text-xl font-semibold mb-4 text-gray-200">Filiales</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3">
                <template x-for="filiale in filialesPrincipales" :key="filiale.id">
                    <button @click="filtreFiliale = filtreFiliale === filiale.id ? null : filiale.id"
                            class="filiale-card p-3 rounded-lg text-left transition-all"
                            :class="filtreFiliale === filiale.id ? 'ring-2 ring-white' : ''"
                            :style="'background-color: ' + filiale.couleur + '20; border: 1px solid ' + filiale.couleur">
                        <p class="font-medium text-sm truncate" :style="'color: ' + filiale.couleur" x-text="filiale.nom"></p>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-lg font-bold text-white" x-text="filiale.enCours"></span>
                            <span class="text-xs text-gray-400">en cours</span>
                        </div>
                        <template x-if="filiale.bloquees > 0">
                            <span class="text-xs text-red-400" x-text="filiale.bloquees + ' bloquee(s)'"></span>
                        </template>
                    </button>
                </template>
            </div>
        </section>

        <!-- Missions Actives -->
        <section class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold text-gray-200">Missions Actives</h2>
                <template x-if="filtreFiliale">
                    <button @click="filtreFiliale = null" class="text-sm text-gray-400 hover:text-white">
                        Effacer filtre ‚úï
                    </button>
                </template>
            </div>

            <div class="space-y-4">
                <template x-for="mission in missionsFiltered" :key="mission.id">
                    <div class="mission-card bg-gray-800 rounded-lg p-4 border-l-4"
                         :style="'border-color: ' + getCouleurFiliale(mission.filiale)">
                        <div class="flex items-start justify-between mb-2">
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="badge text-xs px-2 py-0.5 rounded"
                                          :class="mission.statut === 'bloquee' ? 'bg-red-500/20 text-red-400' : 'bg-green-500/20 text-green-400'"
                                          x-text="mission.statut === 'bloquee' ? 'BLOQUEE' : 'EN COURS'"></span>
                                    <span class="badge text-xs px-2 py-0.5 rounded bg-gray-700 text-gray-300" x-text="mission.priorite"></span>
                                    <template x-if="mission.deadline">
                                        <span class="badge text-xs px-2 py-0.5 rounded bg-red-500/20 text-red-400">
                                            ‚è∞ <span x-text="mission.deadline"></span>
                                        </span>
                                    </template>
                                </div>
                                <h3 class="font-semibold text-white" x-text="mission.nom"></h3>
                                <p class="text-sm text-gray-400" x-text="mission.description"></p>
                            </div>
                            <span class="text-xs px-2 py-1 rounded bg-gray-700 text-gray-300 whitespace-nowrap"
                                  :style="'color: ' + getCouleurFiliale(mission.filiale)"
                                  x-text="mission.filiale.toUpperCase()"></span>
                        </div>

                        <div class="mt-3 pt-3 border-t border-gray-700">
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="text-gray-500">Phase</p>
                                    <p class="text-gray-200" x-text="mission.phase"></p>
                                </div>
                                <div>
                                    <p class="text-gray-500">Etape</p>
                                    <p class="text-gray-200" x-text="mission.etape"></p>
                                </div>
                            </div>
                            <div class="mt-2">
                                <p class="text-gray-500 text-sm">Progression</p>
                                <div class="flex items-center gap-2 mt-1">
                                    <div class="flex-1 bg-gray-700 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full" :style="'width: ' + getProgression(mission.progression) + '%'"></div>
                                    </div>
                                    <span class="text-xs text-gray-400" x-text="mission.progression + ' etapes'"></span>
                                </div>
                            </div>
                            <template x-if="mission.blocage">
                                <div class="mt-3 p-2 bg-red-900/30 rounded text-sm">
                                    <span class="text-red-400 font-medium">Blocage : </span>
                                    <span class="text-red-300" x-text="mission.blocage"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </section>

        <!-- Backlog Priorite Absolue -->
        <section class="mb-8">
            <h2 class="text-xl font-semibold mb-4 text-gray-200">Backlog - Priorite Absolue</h2>
            <p class="text-gray-400 text-sm mb-4">13 missions a creer apres les 4 missions actives</p>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
                <table class="w-full text-sm">
                    <thead class="bg-gray-700">
                        <tr>
                            <th class="px-4 py-2 text-left text-gray-300">#</th>
                            <th class="px-4 py-2 text-left text-gray-300">Mission</th>
                            <th class="px-4 py-2 text-left text-gray-300">Filiale</th>
                            <th class="px-4 py-2 text-left text-gray-300">Priorite</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="(mission, index) in data.backlog?.prioriteAbsolue || []" :key="mission.id">
                            <tr class="border-t border-gray-700 hover:bg-gray-700/50">
                                <td class="px-4 py-2 text-gray-400" x-text="mission.id"></td>
                                <td class="px-4 py-2">
                                    <p class="text-white" x-text="mission.nom"></p>
                                    <p class="text-gray-400 text-xs" x-text="mission.description"></p>
                                </td>
                                <td class="px-4 py-2 text-gray-300" x-text="mission.filiale.toUpperCase()"></td>
                                <td class="px-4 py-2">
                                    <span class="text-xs px-2 py-0.5 rounded bg-orange-500/20 text-orange-400" x-text="mission.priorite"></span>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Backlog par Filiale -->
        <section>
            <h2 class="text-xl font-semibold mb-4 text-gray-200">Backlog par Filiale</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3">
                <template x-for="(count, filiale) in data.backlog?.parFiliale || {}" :key="filiale">
                    <div class="bg-gray-800 rounded-lg p-3 border border-gray-700">
                        <p class="text-xs text-gray-400 truncate" x-text="filiale.toUpperCase()"></p>
                        <p class="text-2xl font-bold text-white" x-text="count"></p>
                        <p class="text-xs text-gray-500">missions</p>
                    </div>
                </template>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 border-t border-gray-700 px-6 py-4 mt-8">
        <div class="max-w-7xl mx-auto text-center text-gray-400 text-sm">
            <p>Dashboard CEO ODIA HOLDING - Genere par /consolidateur-pilote</p>
            <p class="mt-1">Source : vue-groupe.md + missions-unifiees.md</p>
        </div>
    </footer>

    <script src="app.js"></script>
</body>
</html>
